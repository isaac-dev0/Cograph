# ------------------------------------------------------
# THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
# ------------------------------------------------------

type Profile {
  id: ID!
  userId: String!
  email: String!
  displayName: String!
  job: String
  location: String
  avatarUrl: String
  githubToken: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
A date-time string at UTC, such as 2019-12-03T09:54:33Z, compliant with the date-time format.
"""
scalar DateTime

"""Represents a user who is part of a project."""
type ProjectMember {
  """
  Unique identifier of the user (profile) associated with this membership.
  """
  profileId: ID!

  """Unique identifier of the project this member belongs to."""
  projectId: ID!

  """Role of the user within the project, e.g., OWNER, ADMIN, or MEMBER."""
  role: ProjectRole!

  """Profile of the user."""
  profile: Profile!

  """Timestamp of when this member was added to the project."""
  createdAt: DateTime!

  """Timestamp of the last update to this project member record."""
  updatedAt: DateTime!
}

"""Specifies the level of permissions a member has within a project."""
enum ProjectRole {
  OWNER
  ADMIN
  MEMBER
  GUEST
}

"""
A project that contains members, an owner, and metadata such as name and description.
"""
type Project {
  """Unique identifier of the project."""
  id: ID!

  """The name of the project."""
  name: String!

  """Optional text description of the project's purpose or details."""
  description: String

  """URL to the project logo image."""
  icon: String

  """Unique identifier of the user who owns this project."""
  ownerId: ID!

  """Status of the project, e.g., ACTIVE, ARCHIVED"""
  status: ProjectStatus!

  """Timestamp of when the project was created."""
  createdAt: DateTime!

  """Timestamp of the last update to the project."""
  updatedAt: DateTime!

  """Timestamp of when the project was archived."""
  archivedAt: DateTime

  """Owner object of the project"""
  owner: Profile

  """Members of the project"""
  members: [ProjectMember!]
}

"""Specifies the status of a project."""
enum ProjectStatus {
  ACTIVE
  ARCHIVED
}

"""History of sync operations performed on a repository."""
type RepositorySyncHistory {
  """Unique identifier of the sync history record."""
  id: ID!

  """ID of the repository this sync history entry belongs to."""
  repositoryId: String!

  """The repository associated with this sync event."""
  repository: Repository!

  """Timestamp when the sync process started."""
  syncStartedAt: DateTime!

  """Timestamp when the sync process finished."""
  syncCompletedAt: DateTime

  """Status of the sync process (e.g., PENDING, SUCCESS, FAILED)."""
  status: String!

  """Error message from the sync process, if any."""
  error: String

  """Number of files processed during the sync."""
  filesProcessed: Int!

  """Duration of the sync in milliseconds."""
  duration: Int

  """Timestamp when this sync history record was created."""
  createdAt: DateTime!
}

"""A repository that contains files from Github."""
type Repository {
  """Unique identifier of the repository."""
  id: ID!

  """Unique identifier of the Github repository."""
  githubId: Int!

  """Unique identifier of the node."""
  nodeId: String!

  """Name of the repository."""
  name: String!

  """Full name of the repository with organisation or user slug."""
  fullName: String!

  """Description of the repository"""
  description: String

  """Visibility of the Github repository"""
  visibility: String!

  """URL of the Github repository"""
  repositoryUrl: String!

  """Icon/logo URL for the repository."""
  icon: String

  """Login of the repository owner."""
  ownerLogin: String!

  """Type of the owner such as organisation or user."""
  ownerType: String!

  """Avatar URL for the owner of the repository."""
  ownerAvatarUrl: String!

  """Date when the repository was last synced."""
  lastSyncedAt: DateTime

  """Status of the repository sync, e.g., PENDING, SYNCING, SYNCED, FAILED"""
  syncStatus: SyncStatus!

  """Error encountered from syncing."""
  syncError: String

  """Is the repository currently archived?"""
  isArchived: Boolean!

  """Is the repository currently disabled?"""
  isDisabled: Boolean!

  """Is the repository public or private?"""
  isPrivate: Boolean!

  """Github timestamp of when the repository was created."""
  githubCreatedAt: DateTime!

  """Github timestamp of the last update to the repository."""
  githubUpdatedAt: DateTime!

  """Timestamp of when the repository was previously pushed to."""
  githubPushedAt: DateTime!

  """Timestamp of when the repository was created."""
  createdAt: DateTime!

  """Timestamp of the last update to the repository."""
  updatedAt: DateTime!

  """Timestamp of when the repository was archived."""
  archivedAt: DateTime
  syncHistory: [RepositorySyncHistory!]
}

"""Specifies the status of a sync operation"""
enum SyncStatus {
  PENDING
  SYNCING
  SYNCED
  FAILED
}

"""An analysis job for processing a repository."""
type AnalysisJob {
  """Unique identifier of the analysis job."""
  id: ID!

  """ID of the repository being analysed."""
  repositoryId: ID!

  """Current status of the analysis job."""
  status: AnalysisStatus!

  """Progress percentage of the analysis (0-100)."""
  progress: Float!

  """Number of files that have been analysed."""
  filesAnalysed: Int!

  """Total number of files to be analysed."""
  totalFiles: Int

  """Error message if the analysis failed."""
  errorMessage: String

  """Detailed error information if the analysis failed."""
  errorDetails: String

  """Timestamp when the analysis started."""
  startedAt: DateTime

  """Timestamp when the analysis completed."""
  completedAt: DateTime

  """Timestamp when the job was created."""
  createdAt: DateTime!

  """Timestamp when the job was last updated."""
  updatedAt: DateTime!
}

"""Status of a repository analysis job."""
enum AnalysisStatus {
  PENDING
  CLONING
  ANALYSING
  COMPLETED
  FAILED
}

"""A code entity extracted from a repository file."""
type CodeEntity {
  """Unique identifier of the code entity."""
  id: ID!

  """ID of the repository file this entity belongs to."""
  repositoryFileId: ID!

  """Name of the entity (e.g., function name, class name)."""
  name: String!

  """Type of entity (e.g., function, class, interface)."""
  type: String!

  """Starting line number of the entity in the file."""
  startLine: Int!

  """Ending line number of the entity in the file."""
  endLine: Int!

  """User-provided annotations for this entity."""
  annotations: String

  """Timestamp when the entity was created."""
  createdAt: DateTime!

  """Timestamp when the entity was last updated."""
  updatedAt: DateTime!
}

"""A file within a repository that has been analysed."""
type RepositoryFile {
  """Unique identifier of the repository file."""
  id: ID!

  """ID of the repository this file belongs to."""
  repositoryId: ID!

  """Relative path of the file within the repository."""
  filePath: String!

  """Name of the file."""
  fileName: String!

  """Type/extension of the file."""
  fileType: String!

  """Number of lines of code in the file."""
  linesOfCode: Int!

  """Neo4j node ID for graph database reference."""
  neo4jNodeId: String

  """AI-generated summary of the file contents."""
  claudeSummary: String

  """Timestamp when the file record was created."""
  createdAt: DateTime!

  """Timestamp when the file record was last updated."""
  updatedAt: DateTime!

  """Code entities (functions, classes, etc.) found in this file."""
  codeEntities: [CodeEntity!]
  annotations: [FileAnnotation!]
}

"""Author information for a file annotation."""
type AnnotationAuthor {
  """
  Profile ID of the annotation author. Null if the profile has been deleted.
  """
  id: ID

  """Display name of the annotation author."""
  name: String!
}

"""A user-created annotation on a repository file."""
type FileAnnotation {
  """Unique identifier of the annotation."""
  id: ID!

  """Title of the annotation (max 200 characters)."""
  title: String!

  """Markdown content of the annotation."""
  content: String!

  """Tags associated with this annotation."""
  tags: [String!]!

  """IDs of code entities linked to this annotation."""
  linkedEntityIds: [ID!]!

  """Author of the annotation."""
  author: AnnotationAuthor!

  """Timestamp when the annotation was created."""
  createdAt: DateTime!

  """Timestamp when the annotation was last updated."""
  updatedAt: DateTime!
}

"""A node in the dependency graph"""
type GraphNode {
  """Unique identifier for the node"""
  id: ID!

  """Display label for the node"""
  label: String!

  """Type of node (FILE, FUNCTION, CLASS, INTERFACE)"""
  type: NodeType!

  """Additional node metadata as JSON string"""
  data: String!
}

"""Types of nodes in the dependency graph"""
enum NodeType {
  FILE
  FUNCTION
  CLASS
  INTERFACE
}

"""An edge (relationship) in the dependency graph"""
type GraphEdge {
  """Unique identifier for the edge"""
  id: ID!

  """Source node ID"""
  source: String!

  """Target node ID"""
  target: String!

  """Type of relationship (IMPORTS, EXPORTS, CONTAINS)"""
  type: EdgeType!

  """Additional edge metadata as JSON string (e.g., import specifiers)"""
  data: String
}

"""Types of relationships between nodes"""
enum EdgeType {
  IMPORTS
  EXPORTS
  CONTAINS
}

"""A complete dependency graph with nodes and edges"""
type DependencyGraph {
  """All nodes in the graph"""
  nodes: [GraphNode!]!

  """All edges in the graph"""
  edges: [GraphEdge!]!
}

"""A detected circular dependency in the import graph"""
type CircularDependency {
  """Array of file IDs forming the cycle"""
  cycle: [String!]!

  """Array of file paths forming the cycle"""
  paths: [String!]!

  """Number of files in the cycle"""
  length: Int!
}

type Query {
  """Finds a profile based on Profile ID"""
  findProfileById(id: String!): Profile!

  """Finds a profile based on a Supabase Auth ID"""
  findProfileByUserId(userId: String!): Profile!

  """Searches for a single profile by exact email address."""
  searchProfiles(query: String!): Profile

  """Finds a project by its unique ID"""
  findProjectById(projectId: ID!): Project!

  """Finds projects that the specified profile is a member of."""
  findProjectsByProfileId(profileId: ID!): [Project!]!

  """Finds all members of a project. Caller must be a member."""
  findProjectMembers(projectId: ID!): [ProjectMember!]!

  """Finds repositories associated with a specific project."""
  findRepositoriesByProjectId(projectId: ID!): [Repository!]!

  """Finds all repositories with optional filters."""
  findAllRepositories(options: FindRepositoriesInput): [Repository!]!

  """Finds a repository by its GitHub ID."""
  findRepositoryByGithubId(githubId: Int!): Repository

  """Finds a repository by its full name (e.g., "owner/repo")."""
  findRepositoryByFullName(fullName: String!): Repository

  """Retrieves an analysis job by its ID."""
  analysisJob(id: ID!): AnalysisJob!

  """Retrieves all files for a repository, sorted alphabetically by path."""
  repositoryFiles(repositoryId: ID!): [RepositoryFile!]!

  """Retrieves a single repository file by its ID, including code entities."""
  repositoryFile(id: ID!): RepositoryFile!

  """Fetches the raw content of a file from GitHub."""
  fileContent(id: ID!): String!

  """
  Returns the complete dependency graph for a repository with all nodes and edges. Supports pagination and filtering.
  """
  repositoryGraph(repositoryId: ID!, options: GraphOptionsInput): DependencyGraph!

  """
  Returns all files that the specified file depends on (imports). Supports depth control for N-hop traversal.
  """
  fileDependencies(fileId: ID!, options: GraphOptionsInput): DependencyGraph!

  """
  Returns all files that depend on (import) the specified file. Supports depth control for N-hop traversal.
  """
  fileDependents(fileId: ID!, options: GraphOptionsInput): DependencyGraph!

  """Returns the total number of file nodes in the repository."""
  repositoryNodeCount(repositoryId: ID!): Float!

  """
  Detects and returns all circular dependencies (import cycles) in the repository. Limited to 100 results.
  """
  circularDependencies(repositoryId: ID!): [CircularDependency!]!

  """
  Returns files filtered by extension (e.g., "ts", "tsx", "js") with their dependencies.
  """
  filesByType(repositoryId: ID!, fileType: String!, options: GraphOptionsInput): DependencyGraph!
}

input FindRepositoriesInput {
  includeArchived: Boolean
  includePrivate: Boolean
  owner: String
}

"""Options for filtering and controlling graph queries"""
input GraphOptionsInput {
  """
  Maximum traversal depth for dependency queries (1, 2, 3, or -1 for unlimited)
  """
  maxDepth: Int

  """Filter by file types/extensions (e.g., ["ts", "tsx", "js"])"""
  fileTypes: [String!]

  """Include external library dependencies in the graph"""
  includeExternal: Boolean

  """Maximum number of nodes to return (pagination limit)"""
  limit: Int

  """Number of nodes to skip (pagination offset)"""
  offset: Int
}

type Mutation {
  """Finds or creates a user profile based on Supabase Auth Data (Upsert)."""
  syncProfile(data: SyncProfileInput!): Profile!

  """Updates the authenticated user's profile"""
  updateProfile(updateProfileInput: UpdateProfileInput!): Profile!

  """Creates a project given the specified parameters."""
  createProject(createProjectInput: CreateProjectInput!): Project!

  """Updates an existing project."""
  updateProject(projectId: ID!, updateProjectInput: UpdateProjectInput!): Project!

  """Updates a project member's role."""
  updateProjectMemberRole(projectId: ID!, memberId: ID!, role: ProjectRole!): ProjectMember!

  """Transfers ownership of a project to another member."""
  transferProjectOwnership(projectId: ID!, newOwnerId: ID!): Project!

  """Adds one or more members to a project."""
  addProjectMembers(projectId: ID!, profileIds: [ID!]!): [ProjectMember!]!

  """Removes a member from a project."""
  removeProjectMember(projectId: ID!, profileId: ID!): ProjectMember!

  """Archives a project (soft delete)."""
  archiveProject(projectId: ID!): Project!

  """
  Fetches repositories from GitHub API and imports them into the database.
  """
  syncRepositoriesFromGitHub(input: SyncRepositoriesInput!): Boolean!

  """Archives a repository (soft delete)."""
  archiveRepository(repositoryId: ID!): Repository!

  """Adds one or more repositories to a project."""
  addRepositoriesToProject(projectId: ID!, repositoryIds: [ID!]!): Boolean!

  """Removes a repository from a project."""
  removeRepositoryFromProject(projectId: ID!, repositoryId: ID!): Boolean!

  """Triggers analysis of a repository. Returns the created analysis job."""
  analyseRepository(repositoryId: ID!): AnalysisJob!

  """Updates the user annotation for a repository file."""
  updateFileAnnotation(id: ID!, annotation: String!): RepositoryFile!

  """Updates the Claude summary for a repository file."""
  updateFileSummary(id: ID!, summary: String!): RepositoryFile!

  """
  Generates an AI summary for a file using Claude. Can regenerate existing summaries.
  """
  generateFileSummary(fileId: ID!, regenerate: Boolean! = false): RepositoryFile!

  """Creates a new annotation on a repository file."""
  createAnnotation(fileId: ID!, input: CreateAnnotationInput!): FileAnnotation!

  """Updates an existing annotation. Only the author can update it."""
  updateAnnotation(fileId: ID!, annotationId: ID!, input: UpdateAnnotationInput!): FileAnnotation!

  """Deletes an annotation. Only the author can delete it."""
  deleteAnnotation(fileId: ID!, annotationId: ID!): Boolean!
}

input SyncProfileInput {
  """The unique Supabase Auth User ID (UID)."""
  userId: ID!

  """The user's email address."""
  email: String!

  """The user's public display name."""
  displayName: String!
}

input UpdateProfileInput {
  job: String
  location: String
  avatarUrl: String
  githubToken: String
}

input CreateProjectInput {
  """Name of the project"""
  name: String!

  """Description of the project"""
  description: String

  """Supabase User ID of the project owner"""
  ownerId: ID!
}

input UpdateProjectInput {
  """Name of the project"""
  name: String

  """Description of the project"""
  description: String

  """Supabase User ID of the project owner"""
  ownerId: ID
}

input SyncRepositoriesInput {
  """GitHub access token for authenticating with GitHub API"""
  githubToken: String!
}

input CreateAnnotationInput {
  """Title of the annotation"""
  title: String!

  """Markdown content of the annotation"""
  content: String!

  """Tags for organizing the annotation"""
  tags: [String!]

  """IDs of code entities linked to this annotation"""
  linkedEntityIds: [ID!]
}

input UpdateAnnotationInput {
  """Title of the annotation"""
  title: String

  """Markdown content of the annotation"""
  content: String

  """Tags for organizing the annotation"""
  tags: [String!]

  """IDs of code entities linked to this annotation"""
  linkedEntityIds: [ID!]
}